<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ServeSmartAI</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root { --bg:#0f1115; --panel:#151821; --ink:#e9ecf1; --muted:#9aa3b2; --accent:#6aa6ff; --ring:#263045; }
  * { box-sizing:border-box; }
  body { margin:0; font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--ink); }
  .wrap { height:100svh; display:grid; grid-template-rows:auto 1fr auto; }
  header { display:flex; align-items:center; gap:12px; padding:14px 18px; border-bottom:1px solid var(--ring); background:linear-gradient(180deg,#0f1115,#12151b); }
  header img.logo { width:28px; height:28px; border-radius:6px; object-fit:cover; }
  header h1 { font-size:16px; margin:0; font-weight:600; letter-spacing:.2px; }
  .controls { margin-left:auto; display:flex; gap:10px; align-items:center; }
  select, button { background:var(--panel); color:var(--ink); border:1px solid var(--ring); border-radius:10px; padding:10px 12px; font:inherit; }
  select:focus, button:focus, input:focus { outline:2px solid var(--accent); outline-offset:2px; }
  .chat { display:grid; grid-template-rows:1fr auto; max-width:980px; margin:0 auto; width:100%; }
  .messages { padding:18px; overflow:auto; }
  .bubble { max-width:80ch; padding:12px 14px; border-radius:14px; margin:8px 0; line-height:1.55; }
  .user { background:#1d2230; border:1px solid var(--ring); margin-left:auto; }
  .ai { background:#121620; border:1px solid var(--ring); white-space:pre-wrap; }
  .composer { border-top:1px solid var(--ring); padding:12px; display:flex; gap:10px; align-items:center; background:linear-gradient(180deg,#11141b,#0f1115); }
  .input { flex:1; background:var(--panel); border:1px solid var(--ring); border-radius:14px; padding:14px 16px; color:var(--ink); }
  .input::placeholder { text-align:center; color:var(--muted); }
  .send { padding:12px 16px; border-radius:12px; cursor:pointer; }
  .hint { color:var(--muted); font-size:12px; padding:0 18px 8px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <img class="logo" src="logo.png" alt="ServeSmartAI">
    <h1>ServeSmartAI</h1>
    <div class="controls">
      <label for="model" style="font-size:12px;color:var(--muted)">Model</label>
      <select id="model"></select>
    </div>
  </header>

  <div class="hint">Your key is safe. The browser talks to <code>/api/straico/chat</code> on Vercel, which adds the key server side.</div>

  <main class="chat">
    <div id="messages" class="messages"></div>
    <div class="composer">
      <input id="prompt" class="input" placeholder="Write message" />
      <button id="send" class="send">Send</button>
    </div>
  </main>
</div>

<script>
  // Add or rename to match the models Straico exposes in your account
  const MODELS = [
    { id: 'gpt-4o-mini', label: 'GPT 4o mini' },
    { id: 'claude-3-5-sonnet', label: 'Claude 3.5 Sonnet' },
    { id: 'claude-3-5-haiku', label: 'Claude 3.5 Haiku' },
    { id: 'llama-3.3-70b-instruct', label: 'Llama 3.3 70B Instruct' }
  ];

  const modelSel = document.getElementById('model');
  MODELS.forEach(m => {
    const o = document.createElement('option');
    o.value = m.id; o.textContent = m.label;
    modelSel.appendChild(o);
  });

  const messagesEl = document.getElementById('messages');
  const promptEl = document.getElementById('prompt');
  const sendBtn = document.getElementById('send');
  const history = [{ role:'system', content:'You are a helpful assistant.' }];

  function addBubble(text, who) {
    const b = document.createElement('div');
    b.className = 'bubble ' + (who === 'user' ? 'user' : 'ai');
    b.textContent = text;
    messagesEl.appendChild(b);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  async function send() {
    const text = promptEl.value.trim();
    if (!text) return;
    promptEl.value = '';
    history.push({ role:'user', content:text });
    addBubble(text, 'user');

    try {
      const r = await fetch('/api/straico/chat', {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify({
          model: modelSel.value,
          messages: history,
          stream: false
        })
      });

      if (!r.ok) {
        const t = await r.text();
        addBubble('Error ' + r.status + ': ' + t, 'ai');
        return;
      }

      const data = await r.json();
      const reply = data?.choices?.[0]?.message?.content || JSON.stringify(data);
      history.push({ role:'assistant', content: reply });
      addBubble(reply, 'ai');
    } catch (e) {
      addBubble('Network error. Check the proxy or model id.', 'ai');
    }
  }

  sendBtn.addEventListener('click', send);
  promptEl.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) send(); });
</script>
</body>
</html>
